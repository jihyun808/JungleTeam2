<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>경기 예매 - Time-Pitch</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='booking.css') }}">
</head>

<body class="min-h-screen bg-gray-50">
  <header class="border-b bg-white/95 backdrop-blur sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4">
      <!-- Logo Section -->
      <div class="flex items-center justify-between mb-4">
        <a href="/" class="flex items-center space-x-2">
          <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h18M4 8h16M6 13h12M9 18h6" />
            </svg>
          </div>
          <span class="font-bold text-lg">Time‑Pitch</span>
        </a>
      </div>
      <!-- Navigation Section -->
      <nav class="flex items-center justify-between text-sm">
        <!-- Left side -->
        <div class="flex items-center gap-2">
          <a href="/" class="text-base px-3 py-2 rounded-md text-gray-600 hover:bg-gray-100 font-medium">홈</a>
          <a href="/booking" class="text-base px-3 py-2 rounded-md bg-blue-100 text-blue-700 font-semibold">예매</a>
        </div>
        <!-- Right side -->
        <div class="flex items-center gap-6">
          <a href="/signin"
            class="flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
            </svg>
            로그인
          </a>
          <a href="/mypage" class="flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-800 text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            마이페이지
          </a>
        </div>
      </nav>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <div class="mb-6">
      <h1 class="text-2xl font-bold">경기 예매</h1>
      <p class="text-gray-600">원하시는 날짜와 경기를 선택하세요.</p>
    </div>

    <!-- 필터 -->
    <div class="grid md:grid-cols-4 gap-4 mb-6">
      <div>
        <label class="block text-sm font-medium mb-1">구단</label>
        <select id="teamFilter" class="w-full border rounded-lg p-2">
          <option value="">전체</option>
          <option>LG 트윈스</option>
          <option>두산 베어스</option>
          <option>롯데 자이언츠</option>
          <option>KIA 타이거즈</option>
          <option>삼성 라이온즈</option>
          <option>SSG 랜더스</option>
          <option>KT 위즈</option>
          <option>키움 히어로즈</option>
          <option>NC 다이노스</option>
          <option>한화 이글스</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">구장</label>
        <select id="stadiumFilter" class="w-full border rounded-lg p-2">
          <option value="">전체</option>
          <option>잠실</option>
          <option>사직</option>
          <option>고척</option>
          <option>대전</option>
          <option>광주</option>
          <option>수원</option>
          <option>창원</option>
          <option>대구</option>
          <option>문학</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">날짜</label>
        <input id="dateFilter" type="date" class="w-full border rounded-lg p-2" />
      </div>
      <div class="flex items-end">
        <button id="resetFilters" class="w-full border rounded-lg p-2 hover:bg-gray-100">초기화</button>
      </div>
    </div>
    <!-- 경기 리스트 -->
    <div id="scheduleList"></div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-12 mt-16">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <a href="#" class="flex items-center space-x-2 mb-4">
            <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z">
                </path>
              </svg>
            </div>
            <h3 class="text-xl font-bold">Time-Pitch</h3>
          </a>
          <p class="text-gray-400">공정한 야구 티켓 예매 플랫폼</p>
        </div>
        <div>
          <h4 class="font-bold mb-4">서비스</h4>
          <ul class="space-y-2 text-gray-400">
            <li><a href="#booking" class="hover:text-white transition-colors">티켓 예매</a></li>
            <li><a href="#" class="hover:text-white transition-colors">구단 순위</a></li>
            <li><a href="#" class="hover:text-white transition-colors">선수 기록</a></li>
            <li><a href="#" class="hover:text-white transition-colors">경기 일정</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-bold mb-4">고객지원</h4>
          <ul class="space-y-2 text-gray-400">
            <li><a href="#" class="hover:text-white transition-colors">FAQ</a></li>
            <li><a href="#" class="hover:text-white transition-colors">고객센터</a></li>
            <li><a href="#" class="hover:text-white transition-colors">환불정책</a></li>
            <li><a href="#" class="hover:text-white transition-colors">이용약관</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-bold mb-4">회사정보</h4>
          <ul class="space-y-2 text-gray-400">
            <li>서울시 강남구</li>
            <li>고객센터: 1588-0000</li>
            <li>이메일: info@time-pitch.com</li>
          </ul>
        </div>
      </div>
      <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
        <p>&copy; 2024 Time-Pitch. All rights reserved.</p>
      </div>
    </div>
  </footer>
</body>

<div id="events-data" data-events='{{param["data"]["events"] | safe}}'></div>
<script>
  let events;
  let teamLogoMap = {
    "한화 이글스": "hanhwa.png",
    "두산 베어스": "dusan.png",
    "KT 위즈": "kt.png",
    "롯데 자이언츠": "lotte.png",
    "LG 트윈스": "lg.png",
    "NC 다이노스": "nc.png",
    "키움 히어로즈": "kiwoom.png",
    "삼성 라이온즈": "samsung.png",
    "기아 타이거즈": "kia.png",
    "SSG 랜더스": "ssg.png",
  };

  function getDayOfWeek(dateString) {
    const days = ["일요일", "월요일", "화요일", "수요일", "목요일", "금요일", "토요일"];

    const date = new Date(dateString);

    return days[date.getDay()];
  }

  function groupGamesByDate(gamesArray) {
    if (!gamesArray) {
      return {}; // 만약 배열이 없으면 빈 객체 반환
    }

    return gamesArray.reduce((acc, game) => {
      // 'YYYY-MM-DD' 형식의 날짜 키 생성
      const dateKey =
        `${game.date.year}-${String(game.date.month).padStart(2, '0')}-${String(game.date.day).padStart(2, '0')}`;

      // 해당 날짜 키가 객체에 없으면 빈 배열을 새로 할당
      if (!acc[dateKey]) {
        acc[dateKey] = [];
      }

      // 해당 날짜의 배열에 현재 경기 정보 추가
      acc[dateKey].push(game);

      return acc;
    }, {}); // 초기값은 빈 객체
  }

  function render(events) {
    events = groupGamesByDate(events);
    console.log(events);
    const box = document.getElementById('scheduleList');
    if (!box) {
      console.log('Nope');
      return;
    };
    box.innerHTML = '';
    if (events.length === 0) {
      console.log('nope');
      box.innerHTML = '<p class="text-gray-500 col-span-full text-center">선택한 조건에 맞는 경기가 없습니다.</p>';
      return;
    }

    Object.keys(events).forEach((date) => {
      const dateHeader = document.createElement('h2');
      dateHeader.className = 'text-2xl font-bold mt-8 mb-4 pb-2 border-b-2 border-gray-200';
      dateHeader.textContent = `${date} (${getDayOfWeek(date)})`;
      box.appendChild(dateHeader);


      const gridContainer = document.createElement('div');
      gridContainer.className = 'grid grid-cols-1 md:grid-cols-5 gap-4';
      events[date].forEach((event) => {

        const card = document.createElement('div');

        // 홈/어웨이 팀 로고
        const homeLogo = teamLogoMap[`${event.team1}`] ?
          `<img src="/static/logo/${teamLogoMap[`${event.team1}`]}" alt="${`${event.team1}`}" class="w-8 h-8 object-contain">` :
          '<div class="w-8 h-8"></div>';
        const awayLogo = teamLogoMap[`${event.team2}`] ?
          `<img src="/static/logo/${teamLogoMap[`${event.team2}`]}" alt="${`${event.team2}`}" class="w-8 h-8 object-contain">` :
          '<div class="w-8 h-8"></div>';

        const isBookingDisabled = event.date.month == 9; // 9월이면 비활성화

        // 버튼 HTML 생성
        let buttonHtml;
        if (isBookingDisabled) {
          // 회색 비활성화 버튼
          buttonHtml = `
                  <button class="mt-2 w-full inline-flex items-center justify-center rounded-lg bg-gray-400 text-gray-200 px-3 py-2 font-semibold cursor-not-allowed" disabled>
                    8월 14시에 오픈됩니다
                  </button>
                `;
        } else {
          // 활성화된 예매 버튼
          buttonHtml = `
                  <button class="mt-2 w-full inline-flex items-center justify-center rounded-lg bg-blue-600 text-white px-3 py-2 hover:bg-blue-700 font-semibold">
                    예매하기
                  </button>
                `;
        }

        card.className =
          'bg-white border rounded-xl p-4 flex flex-col gap-2 shadow-sm hover:shadow-md transition-shadow'; // Added shadow
        card.innerHTML = `
      <div class="text-sm text-gray-500 font-medium">${event.date.year}-${event.date.month}-${event.date.day}/${event.date.hour}:${event.date.minute}</div>
      ${homeLogo}
      <div class="font-bold text-lg">${event.team1} <span class="font-normal text-gray-600">vs</span> ${event.team2}</div>
      ${awayLogo}
      <div class="text-sm text-gray-600">${event.stadium} 구장</div>${buttonHtml}
    `;
        card.querySelector('button').addEventListener('click', () => {
          window.location.href = `/booking/select_event?event_id=${event.event_id}`;
        });
      gridContainer.appendChild(card);
      });
    box.appendChild(gridContainer);
    });
  };

  window.onload = function () {
    events = JSON.parse(document.getElementById('events-data').getAttribute('data-events'));
    console.log(events);
    render(events);
  };
</script>

  {% if param["message"] %}
<script>
  alert(`{{param["message"]}}`);
</script>
{% endif %}
</html>